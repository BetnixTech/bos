<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bnOS Desktop</title>
<link rel="stylesheet" href="js-dos.css">
  <script src="js-dos.js"></script>
</head>
<body>

  <!-- Desktop icons, etc. -->
  <div class="desktop-icon" ondblclick="launchDoom()">DOOM</div>

  <!-- Game window -->
  <div id="doom-window" style="display:none; width:800px; height:600px; position:absolute; top:50px; left:50px; background:black;">
    <div id="jsdos" style="width:100%; height:100%;"></div>
  </div>

  <script>
    function launchDoom() {
      document.getElementById("doom-window").style.display = "block";
      Dos(document.getElementById("jsdos")).run("/static/games/doom.jsdos");
    }
  </script>
<style>
  /* -------------------------------
   Desktop Window General Style
--------------------------------*/
body {
    margin: 0;
    font-family: "Ubuntu Mono", monospace;
    background-color: #1e1e1e;
    color: #e0e0e0;
    overflow: hidden;
}

/* Desktop icons */
.icon {
    width: 80px;
    text-align: center;
    margin: 10px;
    cursor: pointer;
    float: left;
}

.icon img {
    width: 48px;
    height: 48px;
}

.icon:hover {
    filter: brightness(1.2);
}

/* Windows */
.window {
    position: absolute;
    background-color: #2e2e2e;
    border: 2px solid #444;
    border-radius: 8px;
    width: 600px;
    height: 400px;
    box-shadow: 0 0 15px rgba(0,0,0,0.7);
    display: none; /* hide by default */
}

.window-header {
    background-color: #3e3e3e;
    padding: 8px;
    font-weight: bold;
    cursor: move;
    border-bottom: 2px solid #444;
    user-select: none;
}

.window-body {
    padding: 10px;
    height: calc(100% - 36px);
    overflow: auto;
}

/* Terminal Output */
#terminal-output {
    background-color: #1e1e1e;
    color: #33ff33;
    padding: 8px;
    height: 300px;
    overflow-y: auto;
    font-family: "Ubuntu Mono", monospace;
    border: 1px solid #444;
    border-radius: 5px;
}

/* Terminal Input */
#terminal-input {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    background-color: #1e1e1e;
    color: #e0e0e0;
    border: 1px solid #444;
    border-radius: 5px;
    font-family: "Ubuntu Mono", monospace;
}

/* Buttons (e.g., Capture) */
button {
    background-color: #444;
    color: #fff;
    border: none;
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 5px;
}

button:hover {
    background-color: #555;
}

/* Video and Canvas for Camera */
#camera-stream, #snapshot {
    display: block;
    margin-top: 10px;
    border-radius: 5px;
    border: 1px solid #555;
}

/* Settings toggles */
input[type="checkbox"] {
    transform: scale(1.2);
    margin-left: 10px;
}

/* Scrollbar for windows */
.window-body::-webkit-scrollbar {
    width: 10px;
}

.window-body::-webkit-scrollbar-track {
    background: #2e2e2e;
}

.window-body::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 5px;
}

/* Dragging cursor for windows */
.window-header:active {
    cursor: grabbing;
}
.calc-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-gap: 5px;
    padding: 10px;
    background-color: #444;
    border-radius: 5px;
}

#calc-display {
    grid-column: 1 / span 4;
    height: 40px;
    font-size: 1.5em;
    text-align: right;
    padding: 5px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 5px;
}

.calc-btn {
    padding: 15px;
    font-size: 1.2em;
    border: none;
    background-color: #666;
    color: white;
    border-radius: 5px;
    cursor: pointer;
}

.calc-btn.operator, .calc-btn.equals {
    background-color: #ff9900;
}

.calc-btn.clear, .calc-btn.backspace {
    background-color: #ff6666;
}

.calc-btn:active {
    background-color: #888;
}
#notification-container {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 9999;
}

.notification {
    background-color: #3e3e3e;
    color: #e0e0e0;
    border: 1px solid #444;
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
}

.notification.show {
    opacity: 1;
}
</style>
</head>
<body>
<div id="notification-container"></div>

<div id="navbar">
  <span id="clock">00:00:00</span>
  <label>Brightness: <input type="range" id="brightness" min="0" max="100" value="100"></label>
  <label>Volume: <input type="range" id="volume" min="0" max="100" value="50"></label>
  <button id="launcher-btn">â˜° Launcher</button>
</div>

<div id="desktop">
  <div class="icon" id="terminal-icon"><img src="terminal.png"><br>Terminal</div>
  <div class="icon" id="calculator-icon"><img src="calculator.png"><br>Calculator</div>
  <div class="icon" id="files-icon"><img src="files.png"><br>Files</div>
  <div class="icon" id="gallery-icon"><img src="gallery.png"><br>Gallery</div>
  <div class="icon" id="settings-icon"><img src="settings.png"><br>Settings</div>

  <!-- Example Windows -->
  <div class="window" id="terminal-window">
    <div class="window-header">Terminal</div>
    <div class="window-body">
      <textarea style="width:100%;height:80%;background:#2e2e2e;color:white;" placeholder="Type code here..."></textarea>
    </div>
  </div>

  <div class="window" id="calculator-window">
    <div class="window-header">Calculator</div>
    <div class="window-body">
      <input type="text" id="calc-input" style="width:100%;background:#2e2e2e;color:white;">
      <button id="calc-btn">=</button>
      <div id="calc-result"></div>
    </div>
  </div>
</div>

<!-- Settings Window -->
<div class="window" id="settings-window">
  <div class="window-header">Settings</div>
  <div class="window-body">
    <label>Wi-Fi: <input type="checkbox" id="wifi-toggle"></label><br>
    <label>Bluetooth: <input type="checkbox" id="bluetooth-toggle"></label><br>
  </div>
</div>

<div class="icon" id="camera-icon">
  <img src="camera.png"><br>Camera
</div>

<div class="window" id="camera-window" style="display:none;">
  <div class="window-header">Camera</div>
  <div class="window-body">
    <video id="camera-stream" autoplay></video>
    <button id="capture-btn">Capture</button>
    <canvas id="snapshot" width="640" height="480"></canvas>
  </div>
</div>

<div class="window" id="terminal-window">
  <div class="window-header">Linux Terminal</div>
  <div class="window-body">
    <pre id="terminal-output"></pre>
    <input type="text" id="terminal-input" placeholder="Enter Linux command...">
  </div>
</div>

<div id="filesApp">
    <h2>Files App</h2>
    <div id="driveList"></div>
    <ul id="fileList"></ul>
</div>

<div class="window" id="settings-window">
  <div class="window-header">Settings</div>
  <div class="window-body">
    <h4>Network & Connectivity</h4>
    <p>Wi-Fi: <span id="wifi-status">Unknown</span></p>
    <label>Wi-Fi: <input type="checkbox" id="wifi-toggle"></label><br>
    <p>Bluetooth: <span id="bluetooth-status">Unknown</span></p>
    <label>Bluetooth: <input type="checkbox" id="bluetooth-toggle"></label><br>
  </div>
</div>





<script>
  // Clock
  function updateClock() {
    const clock = document.getElementById('clock');
    const now = new Date();
    clock.textContent = now.toLocaleTimeString();
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Desktop icons & double-click
  function makeWindowDraggable(win) {
    const header = win.querySelector('.window-header');
    let offsetX, offsetY, isDown = false;
    header.onmousedown = e => {
      isDown = true;
      offsetX = e.clientX - win.offsetLeft;
      offsetY = e.clientY - win.offsetTop;
      win.style.zIndex = 1000;
    };
    document.onmouseup = () => isDown = false;
    document.onmousemove = e => {
      if (!isDown) return;
      win.style.left = e.clientX - offsetX + 'px';
      win.style.top = e.clientY - offsetY + 'px';
    };
  }

  function openWindow(winId) {
    const win = document.getElementById(winId);
    win.style.display = 'block';
    win.style.left = '100px';
    win.style.top = '100px';
    makeWindowDraggable(win);
  }

  const icons = [
    {icon: 'terminal-icon', window: 'terminal-window'},
    {icon: 'calculator-icon', window: 'calculator-window'}
  ];

  icons.forEach(item => {
    let lastClick = 0;
    const el = document.getElementById(item.icon);
    el.addEventListener('click', () => {
      const now = Date.now();
      if (now - lastClick < 300) { // double click
        openWindow(item.window);
      }
      lastClick = now;
    });
  });

  // Calculator
  document.getElementById('calc-btn').onclick = () => {
    const input = document.getElementById('calc-input').value;
    try {
      document.getElementById('calc-result').textContent = eval(input);
    } catch(e) {
      document.getElementById('calc-result').textContent = "Error";
    }
  };

  // Brightness control
  const brightnessSlider = document.getElementById('brightness');
  brightnessSlider.oninput = () => {
    document.body.style.filter = `brightness(${brightnessSlider.value}%)`;
  };

  // Volume control (dummy example)
  const volumeSlider = document.getElementById('volume');
  volumeSlider.oninput = () => {
    console.log("Volume:", volumeSlider.value);
  };

  // Launcher button (dummy)
  document.getElementById('launcher-btn').onclick = () => {
    alert("Launcher clicked!");
  };

  // Wi-Fi toggle
  document.getElementById('wifi-toggle').addEventListener('change', async (e) => {
      const state = e.target.checked ? "on" : "off";
      const response = await fetch("/toggle/wifi", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ state })
      });
      const result = await response.json();
      alert("Wi-Fi " + result.status);
  });

// Bluetooth toggle
  document.getElementById('bluetooth-toggle').addEventListener('change', async (e) => {
      const state = e.target.checked ? "on" : "off";
      const response = await fetch("/toggle/bluetooth", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ state })
      });
      const result = await response.json();
      alert("Bluetooth " + result.status);
  });

    document.getElementById('camera-icon').addEventListener('dblclick', () => {
    document.getElementById('camera-window').style.display = 'block';
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            document.getElementById('camera-stream').srcObject = stream;
        })
        .catch(err => alert("Camera access error: " + err));
});

document.getElementById('capture-btn').addEventListener('click', () => {
    const video = document.getElementById('camera-stream');
    const canvas = document.getElementById('snapshot');
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    // Save image to localStorage or backend
    const dataURL = canvas.toDataURL("image/png");
    localStorage.setItem("camera_snapshot", dataURL);
    alert("Photo captured!");
});

const terminalInput = document.getElementById("terminal-input");
const terminalOutput = document.getElementById("terminal-output");

async function runLinuxCommand(cmd) {
    const response = await fetch("/run/linux", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ command: cmd })
    });
    const data = await response.json();
    if (data.output) terminalOutput.textContent += "$ " + cmd + "\n" + data.output + "\n";
    if (data.error) terminalOutput.textContent += "$ " + cmd + "\nError: " + data.error + "\n";
}

terminalInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
        runLinuxCommand(terminalInput.value);
        terminalInput.value = "";
    }
});

async function loadDrives() {
    let res = await fetch("/drives");
    let drives = await res.json();
    console.log(drives);
    // Populate in Files app UI
}

async function loadFiles(path) {
    let res = await fetch(`/files/${encodeURIComponent(path)}`);
    let files = await res.json();
    console.log(files);
}

async function listDrives() {
    const res = await fetch("/drives");
    const drives = await res.json();

    const driveList = document.getElementById("driveList");
    driveList.innerHTML = "";

    drives.forEach(drive => {
        let btn = document.createElement("button");
        btn.textContent = `${drive.device} (${drive.mountpoint})`;
        btn.onclick = () => listFiles(drive.mountpoint);
        driveList.appendChild(btn);
    });
}

async function listFiles(path) {
    const res = await fetch(`/files/${encodeURIComponent(path)}`);
    const files = await res.json();

    const fileList = document.getElementById("fileList");
    fileList.innerHTML = "";

    files.forEach(file => {
        let li = document.createElement("li");
        li.textContent = file;
        fileList.appendChild(li);
    });
}

// Load drives on startup
window.onload = listDrives;

  
</script>
<script>
  // New function to update the status text in the UI
async function updateStatus() {
    // Fetch WiFi status
    const wifiRes = await fetch("/status/wifi");
    const wifiData = await wifiRes.json();
    document.getElementById("wifi-status").textContent = wifiData.status;
    document.getElementById("wifi-toggle").checked = wifiData.status === "on";

    // Fetch Bluetooth status
    const btRes = await fetch("/status/bluetooth");
    const btData = await btRes.json();
    document.getElementById("bluetooth-status").textContent = btData.status;
    document.getElementById("bluetooth-toggle").checked = btData.status === "on";
}

// Update status when the settings window is opened
document.getElementById('settings-icon').addEventListener('dblclick', () => {
    openWindow('settings-window');
    updateStatus();
});

// Update the toggle event listeners
document.getElementById('wifi-toggle').addEventListener('change', async (e) => {
    const state = e.target.checked ? "on" : "off";
    const response = await fetch("/toggle/wifi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ state })
    });
    // Immediately fetch and update the status after the action
    updateStatus();
});

document.getElementById('bluetooth-toggle').addEventListener('change', async (e) => {
    const state = e.target.checked ? "on" : "off";
    const response = await fetch("/toggle/bluetooth", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ state })
    });
    // Immediately fetch and update the status after the action
    updateStatus();
});

function showNotification(message, type = 'info') {
    const container = document.getElementById("notification-container");
    const notification = document.createElement("div");
    notification.classList.add("notification", type);
    notification.textContent = message;
    container.prepend(notification); // Add to the top of the list

    // Show the notification
    setTimeout(() => {
        notification.classList.add("show");
    }, 10);

    // Hide and remove the notification after 5 seconds
    setTimeout(() => {
        notification.classList.remove("show");
        setTimeout(() => {
            notification.remove();
        }, 500); // Wait for the fade-out transition
    }, 5000);
}
</script>


</body>
</html>
